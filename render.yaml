# Configuration Render.com pour LedgerLift
# Ce fichier décrit l'infrastructure complète de l'application

services:
  # ========================================
  # Backend API Service
  # ========================================
  - type: web
    name: ledgerlift-backend
    runtime: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    plan: free
    region: frankfurt
    healthCheckPath: /api/health
    autoDeploy: true
    
    envVars:
      # === Configuration Node.js ===
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "8080"
      
      # === Base de données ===
      - key: DATABASE_URL
        fromDatabase:
          name: ledgerlift-db
          property: connectionString
      
      # === Session & Sécurité ===
      - key: SESSION_SECRET
        generateValue: true
      - key: SESSION_NAME
        value: ll_session
      - key: SESSION_TTL_SECONDS
        value: "604800"
      
      # === Frontend URL ===
      - key: FRONTEND_URL
        value: https://ledgerlift-frontend.onrender.com
      
      # === API Keys (à configurer manuellement dans Render Dashboard) ===
      - key: ANKR_API_KEY
        value: ""
      - key: ALCHEMY_API_KEY
        value: ""
      - key: GRAPH_TOKEN_API_JWT
        value: ""
      - key: GRAPH_TOKEN_API_KEY
        value: ""
      
      # === Configuration API & URLs ===
      - key: TOKEN_API_BASE_URL
        value: https://token-api.thegraph.com/v1
      - key: PINAX_RPC_URL
        value: ""
      - key: RPC_URL_MAINNET
        value: ""
      
      # === Paramètres de Debugging ===
      - key: LOGS_DEBUG
        value: "false"
      - key: DEBUG_TOKEN_API
        value: "false"
      
      # === Filtres & Limites ===
      - key: SPAM_FILTER_MODE
        value: hard
      - key: ENABLE_SPAM_FILTER
        value: "true"
      - key: TX_DEFAULT_LIMIT
        value: "20"
      - key: TX_MAX_LIMIT
        value: "40"
      - key: TX_RETURN_CAP
        value: "150"
      - key: TX_FETCH_WINDOW_CAP
        value: "80"
      
      # === Performance & Concurrence ===
      - key: PRICING_BATCH_SIZE
        value: "50"
      - key: NETWORK_FETCH_CONCURRENCY
        value: "2"
      - key: NETWORK_ACTIVITY_CONCURRENCY
        value: "2"
      - key: NETWORK_ACTIVITY_PAGE_LIMIT
        value: "5"
      - key: LLAMA_RPM
        value: "60"
      - key: HTTP_TIMEOUT_MS
        value: "15000"
      - key: TOKEN_API_LIMIT_MAX
        value: "40"
      
      # === Feature Flags ===
      - key: ENABLE_DEXSCREENER
        value: "false"
      - key: ENABLE_DEFI_LLAMA
        value: "false"

  # ========================================
  # Frontend Service
  # ========================================
  - type: web
    name: ledgerlift-frontend
    runtime: docker
    dockerfilePath: ./frontend/Dockerfile
    dockerContext: ./frontend
    plan: free
    region: frankfurt
    autoDeploy: true
    
    envVars:
      # === Configuration Node.js ===
      - key: NODE_ENV
        value: production
      - key: NEXT_TELEMETRY_DISABLED
        value: "1"
      
      # === Backend API URL ===
      - key: API_BASE
        value: https://ledgerlift-backend.onrender.com
      
      # === API Keys publiques (à configurer manuellement) ===
      - key: NEXT_PUBLIC_WEB3AUTH_CLIENT_ID
        value: ""
      - key: NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID
        value: ""
      - key: NEXT_PUBLIC_ANKR_API_KEY
        value: ""
      
      # === Configuration par défaut ===
      - key: NEXT_PUBLIC_DEFAULT_NETWORKS
        value: ethereum,polygon,arbitrum,optimism,base
      - key: NEXT_PUBLIC_DASHBOARD_DEFAULT_NETWORKS
        value: ethereum,polygon
      - key: NEXT_PUBLIC_DASHBOARD_MULTI_LIMIT
        value: "3"

# ========================================
# Base de données PostgreSQL
# ========================================
databases:
  - name: ledgerlift-db
    databaseName: ledgerlift
    user: ledgerlift
    plan: free
    region: oregon
    postgresMajorVersion: 16
    ipAllowList: []

